For this calculator, the parameter \Verb+calculation_mode+ should be set to
\Verb+scenario_damage+.

\paragraph{Example 1}

This example illustrates a scenario damage calculation which uses a single
configuration file to first compute the ground motion fields for the given
rupture model and then calculate damage distribution statistics based on the
ground motion fields. A minimal job configuration file required for
running a scenario damage calculation is shown below:

\inputminted[firstline=1,firstnumber=1,fontsize=\footnotesize,frame=single,linenos,bgcolor=lightgray,label=job.ini]{ini}{oqum/risk/verbatim/config_scenario_damage_combined.ini}\\

The general parameters \Verb+description+ and \Verb+calculation_mode+, and
\Verb+exposure_file+ have already been described earlier. The other parameters
seen in the above example configuration file are described below:

\begin{itemize}

  \item \Verb+rupture_model_file+: a parameter used to define the path
	to the earthquake \gls{rupturemodel} file describing the scenario event.

  \item \Verb+rupture_mesh_spacing+: a parameter used to specify the mesh size
  	(in km) used by OpenQuake-engine to discretize the rupture.
  	Note that the smaller the mesh spacing, the greater will be
  	(1) the precision in the calculation and
  	(2) the computational demand.

  \item \Verb+structural_fragility_file+: a parameter used to define the path
	to the structural \gls{fragility model} file.

\end{itemize}

In this case, the ground motion fields will be computed at each of the
locations of the assets in the exposure model. The above calculation can be
run using the command line:

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
user@ubuntu:~\$ oq-engine --run job.ini
\end{Verbatim}

After the calculation is completed, a message similar to the following will be
displayed:

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
Calculation 2680 completed in 13 seconds. Results:
  id | output_type | name
5069 | datastore | dmg_by_asset_and_collapse_map
5070 | datastore | dmg_by_taxon
5071 | datastore | dmg_total
\end{Verbatim}


Note that one or more of the following parameters can be used in the same job
configuration file to provide the corresponding fragility model files:

\begin{itemize}

  \item \Verb+structural_fragility_file+: a parameter used to define the path
    to a structural \gls{fragility model} file

  \item \Verb+nonstructural_fragility_file+: a parameter used to define the path
    to a nonstructural \gls{fragility model} file

  \item \Verb+contents_fragility_file+: a parameter used to define the path
    to a contents \gls{fragility model} file

  \item \Verb+business_interruption_fragility_file+: a parameter used to define
    the path to a business interruption \gls{fragility model} file

\end{itemize}

It is important that the \Verb+lossCategory+ parameter in the metadata section
for each provided fragility model file (``structural'', ``nonstructural'',
``contents'', or ``business\_interruption'') should match the loss type
defined in the configuration file by the relevant keyword above.


\paragraph{Example 2}

This example illustrates a scenario damage calculation which uses separate
configuration files for the hazard and risk parts of a scenario damage
assessment. The first configuration file contains input models and parameters
required for the computation of the ground motion fields due to a given
rupture. The second configuration file contains input models and parameters
required for the calculation of the damage distribution for a portfolio of
assets due to the ground motion fields.

\inputminted[firstline=1,firstnumber=1,fontsize=\footnotesize,frame=single,linenos,bgcolor=lightgray,label=job\_hazard.ini]{ini}{oqum/risk/verbatim/config_scenario_hazard.ini}\\

\inputminted[firstline=1,firstnumber=1,fontsize=\footnotesize,frame=single,linenos,bgcolor=lightgray,label=job\_damage.ini]{ini}{oqum/risk/verbatim/config_scenario_damage_minimal.ini}\\

Now, the above calculations described by the two configuration files
``job\_hazard.ini'' and ``job\_damage.ini'' can be run sequentially using the
command line as follows:

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
user@ubuntu:~\$ oq-engine --run job_hazard.ini,job_damage.ini
\end{Verbatim}

The hazard and risk calculations can also be run separately. In that case, the
calculation id for the hazard calculation or the output id for the specific
ground motion fields output generated by the hazard calculation should be
provided to the OpenQuake-engine while running the risk calculation using the
options \Verb+--hazard-calculation-id+ (or \Verb+--hc+) and 
\Verb+--hazard-output-id+ (or \Verb+--ho+) respectively. This is shown below:

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
user@ubuntu:~\$ oq-engine --run job_hazard.ini
\end{Verbatim}

In the configuration file illustrated above, the list of sites at which the
ground motion values will be computed is provided in a CSV file, specified
using the \Verb+sites_csv+ parameter. The sites used for the hazard
calculation  need not be the same as the locations of the assets in the
exposure model used  for the following risk calculation. In such cases, it is
recommended to set a reasonable search radius (in km) using the
\Verb+asset_hazard_distance+ parameter for the OpenQuake-engine to look for
available hazard values, as shown in the job_damage.ini example file above.

\begin{itemize}

  \item \Verb+asset_hazard_distance+: this parameter indicates the maximum
    allowable distance between an \gls{asset} and the closest hazard input.
    Hazard inputs can include hazard curves or ground motion intensity values.
    If no hazard input is found within this distance, the \gls{asset} is
    skipped and a message is provided mentioning the id of the asset that is
    affected by this issue. If this parameter is not provided, the
    OpenQuake-engine assumes the maximum allowable distance as 5 km.

\end{itemize}

After the hazard calculation is completed, a message similar to the one below
will be displayed in the terminal:

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
Calculation 2681 completed in 4 seconds. Results:
  id | output_type | name
5072 | datastore | gmfs
\end{Verbatim}

In the example above, the calculation id of the hazard calculation is 2681.
There is only one output from this calculation, i.e., the ground motion
fields. The output id for the gmfs generated by the above calculation is 5027.

The risk calculation for computing the damage distribution statistics for the
portfolio of assets can now be run using either:

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
user@ubuntu:~\$ oq-engine --run job_damage.ini --hc 2681
\end{Verbatim}

or

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
user@ubuntu:~\$ oq-engine --run job_damage.ini --ho 5072
\end{Verbatim}

After the calculation is completed, a message similar to the one listed above
in Example~1 will be displayed.

In order to retrieve the calculation id of a previously run hazard calculation,
the option \Verb+---list-hazard-calculations+ (or \Verb+--lhc+) can be used to
display a list of all previously run hazard calculations:

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
job_id |     status |         last_update |         description
  2609 | successful | 2015-12-01 14:14:14 | Mid Nepal earthquake
  ...
  2681 | successful | 2015-12-12 10:00:00 | Scenario hazard example
\end{Verbatim}

The option \Verb+---list-outputs+ (or \Verb+--lo+) can be used to display a
list of all outputs generated during a particular calculation. For instance,

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
user@ubuntu:~\$ oq-engine --lo 2681
\end{Verbatim}

will produce the following display:

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
  id | output_type | name
5072 | datastore | gmfs
\end{Verbatim}



\paragraph{Example 3}

This example illustrates a scenario damage calculation which uses a file
listing a precomputed set of ground motion fields. These ground motion fields
can be computed using the OpenQuake-engine or some other software. The ground
motion fields can be provided in the NRML format as presented in
Section~\ref{subsec:output_event_based_psha}, or as a CSV file. The damage
distribution is computed based on the provided ground motion fields.

\inputminted[firstline=1,firstnumber=1,fontsize=\footnotesize,frame=single,linenos,bgcolor=lightgray,label=job.ini]{ini}{oqum/risk/verbatim/config_scenario_damage_gmf.ini}\\

\begin{itemize}

  \item \Verb+gmfs_file+: a parameter used to define the path
	  to the ground motion fields file in the NRML format

\end{itemize}

The above calculation can be run using the command line:

\begin{Verbatim}[frame=single, commandchars=\\\{\}, samepage=true]
user@ubuntu:~\$ oq-engine --run job.ini
\end{Verbatim}
